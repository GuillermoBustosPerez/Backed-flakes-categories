---
title: "A geometric morphometric approach to testing discrete categories of backed flakes from recurrent centripetal core reduction"
author: "Guillermo Bustos-Pérez"
output: 
  md_document:
    variant: gfm
bibliography: References.bib
csl: "Journal-Paleolithic-Archaeology.csl"
link-citations: true
---
<div align="justify">  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# A geometric morphometric approach to testing discrete categories of backed flakes from recurrent centripetal core reduction.   
Guillermo  Bustos-Pérez $^{(1)}$    
Brad Gravina $^{(2, 3)}$  
Michel Brenet $^{(3, 4)}$   
Francesca Romagnoli $^{(1)}$   

$^{(1)}$ Universidad Autónoma de Madrid. Departamento de Prehistoria y Arqueología, Campus de Cantoblanco, 28049 Madrid, Spain   
$^{(2)}$ Musée national de Préhistoire, MC, 1 rue du Musée, 24260 Les Eyzies de Tayac, France   
$^{(3)}$ UMR-5199 PACEA, Université de Bordeaux, Bâtiment B8, Allée Geoffroy Saint Hilaire, CS 50023, 33615 PESSAC CEDEX, France    
$^{(4)}$ INRAP Grand Sud-Ouest, Centre mixte de recherches archéologiques, Domaine de Campagne, 242460 Campagne, France    

**Abstract**   

Paleolithic lithic assemblages are usually dominated by flakes, which display a high degree of morphological variability. When analyzing Paleolithic lithic assemblages, it is common to classify flakes into categories based on their morphological and technological features, which are linked to the position of the flake in a reduction sequence and how removals are organized in a given production method. For the analysis of Middle Paleolithic lithic assemblages, two categories of flakes are commonly used: core edge flakes and pseudo-Levallois points. A third type, core edge flakes with a limited back, is also commonly found in the archaeological literature, providing an alternative category with a definition that does not match the two previous types but shares many of their morphological and technological features. The present study addresses whether these three flakes constitute discrete categories based on their morphological and technological attributes. Geometric morphometrics are employed on an experimental set composed of the three categories of flakes to quantify morphological variation. Machine learning models and principal components biplots are used to test the discreteness of the categories. The results indicate that geometric morphometrics succeed in capturing the morphological and technological features that characterize each type of product. Pseudo-Levallois points have the highest discreteness of the three technological products, and while some degree of mixture exists between core edge flakes and core edge flakes with a limited back, they are also highly distinguishable. We conclude that the three categories are discrete and can be employed in technological lists of products for the analysis of lithic assemblages and that geometric morphometrics is useful for testing for the validity of categories.    

**Key words**: lithic analysis; lithic technology; geometric morphometrics; machine learning; Middle Paleolithic; Levallois; discoidal    

## 1. Introduction    

Lithic artifacts regularly constitute the most important and abundant remains found on Paleolithic sites. When analyzing lithic assemblages, in addition to taking metric measurements and noting attributes, it is common to classify unmodified flakes according to their morphologies and technological features. This is a crucial part of lithic analysis because it classifies flakes into technological categories in the sense that the retained features and morphology are indicative of the production method by which they were generated. These technological products usually reflect different knapping strategies, stages of reduction as well as variations in the organization of removals and surface exploitation. Well-known examples of technological classifications of flakes include bipolar/on anvil flakes  [@callahan_bipolar_1996; @hayden_confusion_1980], overshot flakes [@cotterell_formation_1987], bifacial-thinning flakes [@raab_debitage_1979], byproducts of blade production, such as core tablets or crested blades [@pelegrin_technologie_1995; @shea_upper_2013], kombewa flakes [@tixier_prehistoire_1980; @tixier_kombewa_1999] and lateral tranchet blows [@bourguignon_analyse_1992]. While the use of technological categories is common and helps increase the resolution of lithic analysis, it is important to bear in mind that lithic artifacts are characterized by a high degree of morphological variability, which, in many cases, results in overlapping features. Consequently, several categories remain underused because of this high morphological variability, their overlapping features, and their similar roles in the volumetric management of the core along the reduction process.     
	
The Middle Paleolithic in Western Europe is characterized by the diversification of an increase in knapping methods, resulting in what are generally flake-dominated assemblages [@kuhn_roots_2013; @hovers_diversity_2006]. For the analysis of Middle Paleolithic lithic assemblages, lists of technological products are common and tend to reflect individual knapping methods, the organization of flake removals, and their morphology [@duran_mousterien_2004; @duran_variabilite_2006; @rigaud_les_1988; @shea_middle_2013]. These technological lists are usually dominated by categories of technological products related to Levallois and discoidal knapping methods [@dibble_levallois:_1995; @boeda_debitage_1993; @boeda_identification_1990], which constitute an important part of Middle Paleolithic lithic variability. Various discoidal and Levallois products have been identified and first appear approximately at 400,000 ka, in a vast area from eastern Asia to the Atlantic coast of Western Europe through Siberia and Central Asia, the Levant, Eastern and Central Europe [see bibliography in @romagnoli_neanderthal_2022], and Africa [@adler_early_2014; @blinkhorn_directional_2021]. The identification of discoidal and Levallois products therefore appears widespread in lithic analysis across various traditions of lithic studies and is designed to create a comparable dataset, explore specific technological adaptations in different ecological contexts, and discuss long-term techno-cultural traditions and technological change. One special category of such products are backed flakes that exhibit remnants of the core on one of their lateral edges. Backed flakes are usually classified into two technological categories: “core edge flakes” (*eclat débordant*) and “pseudo-Levallois points”. A third category, “core edge flakes with a limited back” (*éclat débordant à dos limité*), has also been defined [@meignen_les_1993; @meignen_persistance_1996; @pasty_etude_2004], although its use is not widespread [@duran_mousterien_2004; @duran_variabilite_2006; @rigaud_les_1988; @shea_middle_2013]. One reason for this may be their overlapping features, morphology, and having a similar role in core reduction compared to classic core edge flakes. This usually results in their absorption into the group of core edge flakes when technological lists of products are employed.   

The present study seeks to evaluate whether “core edge flakes with a limited back” are a discrete category that can be easily separated from classic core edge flakes and pseudo-Levallois points based on their morphological features. While it may seem a pleonastic technical exercise, a refined lithic taxonomy allows researchers to achieve an improved understanding of lithic technology. The detailed lithic classification, far to be a redundant and self-seeking exercise, is a basic step to understand patterns of tool production, transport, maintenance, use, discard, and reuse. The importance of itemizing lithic technological classification lies in understanding the differences by which human groups in the past adapted their technical knowledge and skills to resource constraints, economic strategies, and social dynamics. Ultimately, the importance lies in enable researchers to go from description of lithic items to interpretation of human behaviors. Furthermore, an improved and comprehensive use of technological types and sub-types within core trimming elements is mandatory to facilitate comparisons between archaeological assemblages and guarantee a proper communal understanding of past technologies. Finally, core edge flakes are attested during much of prehistoric era being directly related to centripetal and recurrent core knapping. It means that the proper definition and classification of types and sub-types within this technological category will be of use in lithic studies beyond limited chronological and geographical limits.    

To test the discreteness of these categories, an experimental sample of backed flakes produced by discoidal and recurrent centripetal Levallois reduction is classified, following their technological definitions. Geometric morphometrics on 3D meshes are employed to quantify the morphological variability of the experimental assemblage. To test for the discreteness of these categories, machine learning algorithms are employed to classify the flakes according to their technological category. Our hypothesis is that, although some degree of overlap is expected due to the high degree of morphological variability among lithic artifacts, machine learning models should easily differentiate the above-mentioned categories from one another. Testing this hypothesis would support the use of these backed flakes categories in the classification of lithic assemblages.    

The following code loads attribute data from the experimental assemblage and packages employed for the analysis.   

```{r, message=FALSE, warning=FALSE}
# Load packages
list.of.packages <- c("tidyverse", "caret", "Morpho")
lapply(list.of.packages, library, character.only = TRUE)
rm(list.of.packages)

# Load attribute data
Att <- read.csv("Data/Attributes data.csv")
```


## 2. Methods   

### 2.1 Experimental assemblage   

The present study uses an experimental assemblage that was the result of nine knapping sequences. Seven cores were knapped on Bergerac flint [@fernandes_silex_2012] and two cores were knapped on Miocene flint from South of Madrid [@bustillo_caracteristicas_2005; @bustillo_caracterizacion_2012]. Five cores were knapped following the Discoid “sensu stricto” concept, which strongly corresponds to Boëda’s original technological definition of the knapping system [@boeda_debitage_1993; @boeda_concept_1994; @dibble_levallois:_1995], and five experimental cores were knapped following the Levallois recurrent centripetal system [@boeda_debitage_1993; @boeda_concept_1994; @dibble_levallois:_1995; @dibble_recurrent_1995].  

Six technological characteristics define the Levallois concept [@boeda_concept_1994; @boeda_debitage_1993]: (1) the volume of the core is conceived as two convex asymmetric surfaces; (2) these two surfaces are hierarchical and not interchangeable. They maintain their roles as striking platforms and debitage (or exploitation) surfaces, respectively, throughout the entire reduction process; (3) the distal and lateral convexities of the debitage surface are maintained to obtain predetermined flakes; (4) the fracture plane of the predetermined products is parallel to the intersection between both surfaces; (5) the striking platform is perpendicular to the overhang (the core edge, at the intersection between the two core surfaces); (6) the technique employed during the knapping process is direct hard-hammer percussion. Depending on the organization of the debitage surface Levallois cores are usually classified into the preferential method (where a single predetermined Levallois flake is obtained from the debitage surface) or recurrent methods (where several predetermined flakes are produced from the debitage surface), with removals being either unidirectional, bidirectional, or centripetal [@dibble_levallois:_1995; @boeda_identification_1990; @dibble_variability_1995; @hovers_diversity_2006].   

According to Boëda [-@boeda_debitage_1993; -@boeda_concept_1994; -@dibble_levallois:_1995], there are six technological criteria that define the Discoid “sensu stricto” method: (1) the volume of the core is conceived as two oblique asymmetric convex surfaces delimited by an intersecting plane; (2) these two surfaces are not hierarchical, with it being possible to alternate between the roles of striking platforms and exploitation surfaces; (3) the peripheral convexity of the debitage surface is managed to control lateral and distal extractions, thus allowing for a degree of predetermination; (4) the surfaces of the striking platforms are oriented in such a way that the core edge is perpendicular to the predetermined products; (5) the fracture planes of the products are secant; (6) the technique employed is direct hard-hammer percussion.    

A total of 139 unretouched backed flakes (independent of the type of termination) were obtained from the different experimental reduction sequences, 70 from discoidal reduction sequences and 69 from Levallois recurrent centripetal reduction sequences. The following criteria were followed for the classification of backed flakes:  

Core edge flakes / *eclat débordant* [@beyries_etude_1983; @boeda_debitage_1993; @boeda_identification_1990] have a cutting edge opposite and usually (although not always) parallel to an abrupt margin. This abrupt margin, or backed edge (dos), commonly results from the removal of a portion of the periphery of the core and can be plain, bear the scars from previous removals, be cortical, or present a mix of the three. Classic “core edge flakes” [@boeda_debitage_1993; @boeda_identification_1990], which are sometimes referred as “core edge flakes with non-limited back” / *“éclat débordant à dos non limité”* [@duran_lindustrie_2005; @duran_variabilite_2006] have a morphological axis that follows the axis of percussion, although it may deviate slightly [@beyries_etude_1983].   
“Core edge flakes with a limited back” / *“éclat débordant à dos limité”* share with core edge flakes the morphological feature of having a cutting edge opposite a back. However, the main difference resides in their having a morphological axis clearly offset in respect to the axis of percussion [@meignen_les_1993; @meignen_persistance_1996; @pasty_etude_2004]. Because of this deviation from the axis of percussion, the backed edge is usually not completely parallel and does not span the entire length of the sharp edge.   
Pseudo-Levallois points [@boeda_debitage_1993; @boeda_identification_1990; @bordes_notules_1953; @bordes_typologie_1961; @peresani_les_2003] are backed products in which the edge opposite the back has a triangular morphology. This triangular morphology is usually the result of the convergence of two or more removals. As with core edge flakes, the back usually results from the removal of one of the lateral edges of the core and can be plain, retain the scars from previous removals, or more rarely be cortical.  Pseudo-Levallois points share with core edge flakes with a limited back the deviation of symmetry from the axis of percussion, but they are clearly differentiable due to their triangular off-axis morphology.   

The following table presents the distribution of backed flakes types, following the previously established definitions. Due to the centripetal nature of the knapping methods employed to generate the experimental assemblage, most of the backed flakes fall within the definition of core edge flakes with a limited back (66.91%). Cortex distribution according to backed flake category shows that slightly (~25%) or non-cortical products dominate among the three categories, adding up to more than 65% in the three cases (90% core edge flakes, 68.82% core edge flakes with a limited back, and 87.5% pseudo-Levallois points). 

```{r, message=FALSE, warning=FALSE}
Att %>% group_by(Strategy, ARTIFACTTYPE) %>% 
  summarise(
    Count = n(),
    Percent = (Count/139)*100)
```

![Figure 1. Backed artifacts classification types from the experimental assemblage and their classification](Figures/Backed flakes types.png)

```{r Cortex distribution per artefact type, fig.width=10, fig.height=4}
# Cortex per class
Att %>% group_by(ARTIFACTTYPE) %>% 
  count(CORTEX) %>% 
  mutate(Percentage = round(n/sum(n)*100, 2)) %>% 
  
  ggplot(aes(CORTEX, Percentage, fill = ARTIFACTTYPE)) +
  geom_col(position = "dodge") +
  ggsci::scale_fill_aaas(alpha = 0.95) +
  xlab(NULL) +
  geom_text(aes(label = paste0(Percentage, "%")), 
            vjust= -0.2, size = 2.65,
            position = position_dodge(.9)) +
  geom_text(aes(label = paste("n =", n)), 
            vjust= "top", size = 2.65,
            position = position_dodge(.9)) +
  labs(fill = NULL) +
  
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text = element_text(color = "black", size = 8))
```


### 2.2 Geometric Morphometrics   

All flakes were scanned with an Academia 20 structured light surface scanner (Creaform 3D) at a 0.2 mm resolution. Flakes were scanned in two parts, automatically aligned (or manually aligned in the case automatic alignment failure), and exported in STL format. Cloudcompare 2.11.3 (https://www.danielgm.net/cc/) free software was employed to perform additional cleaning, mesh sampling, surface reconstruction and transformation into PLY files. Finally, all files were decimated to a quality of 50,000 faces using the Rvcg R package [@schlager_morpho_2017]. The present work compares the use of 2D and 3D geometric morphometrics.   


Performance of 2D geometric morphometrics was done using screenshots of the upper view of each flake orientated along the technological axis and using free software MeshLab [@cignoni_meshlab_2008]. One thin-plate spline (tps) was generated using tpsUtil v.1.82, and the tpsDig v.2.32 [@rohlf_tps_2015] outline tool was employed to automatically trace the perimeter of each flake. Each outline was resampled to 100 equidistant landmarks (Figure 3) using Morpho v.2.11 [@schlager_morpho_2017]. 

The following code sources the [21 Muggle 2D data](Scripts/21 Muggle 2D data.R) code. This code has been written to import the [2D-Upper-view.tps](Data/2D-Upper-view.tps) file. The file contains a landmark per pixel that defines the perimeter of the flake. After reading the file, the perimeter of each specimen is resampled to have 100 landmarks, and procrustes alignment is performed. A *nosymproc* [@schlager_morpho_2017] object called **Coord.2D** is created, which contains the orientated coordinates, mean shape and results from PC analysis.  

```{r eval=FALSE}
source("Scripts/21 Muggle 2D data.R")
```
```{r include=FALSE}
load("Data/2D data.RData")
```
```{r}
# Plot landmarks of first specimen and mean shape
ggpubr::ggarrange(
  (
    data.frame(Coord.2D$rotated[1:100, 1:2, 1]) %>% 
      ggplot(aes(X2, X1)) +
      geom_point() +
      xlab("y coord") +
      ylab("x coord") +
      coord_fixed() +
      theme_light() +
      scale_x_reverse() +
      ggtitle(label = "First specimen") +
      theme(
        axis.text = element_text(size = 6, color = "black"),
        axis.title = element_text(size = 8, color = "black"),
        plot.title = element_text(hjust = 0.5, vjust = 1, size = 9))
    ),
  
  (
    data.frame(Coord.2D$mshape) %>% 
      ggplot(aes(X2, X1)) +
      geom_point() +
      xlab("y coord") +
      ylab("x coord") +
      coord_fixed() +
      theme_light() +
      scale_x_reverse() +
      ggtitle(label = "Average shape of the sample") +
      theme(
        axis.text = element_text(size = 6, color = "black"),
        axis.title = element_text(size = 8, color = "black"),
        plot.title = element_text(hjust = 0.5, vjust = 1, size = 9))),
  ncol = 2)
```


The protocol for the digitalizing 3D landmarks on flakes is based on previous studies [@archer_geometric_2018; @archer_quantifying_2021]. This included the positioning of a total of three fixed landmarks, 85 curve semi-landmarks, and 420 surface semi-landmarks [@bookstein_landmark_1997; @bookstein_morphometric_1997; @gunz_semilandmarks_2005; @gunz_semilandmarks_2013; @mitteroecker_advances_2009]. This resulted in a total of 508 landmarks and semi-landmarks. The three fixed landmarks correspond to both laterals of the platform and the percussion point. The 85 curve semi-landmarks correspond to the internal and exterior curve outlines of the platform (15 semi-landmarks each) and the edge of the flake (55 semi-landmarks). Sixty surface semi-landmarks correspond to the platform surface. The dorsal and ventral surfaces of the flakes are defined by 180 semi-landmarks each. The workflow for digitalizing landmarks and semi-landmarks included the creation of a template/atlas on an arbitrary selected flake. After this, landmarks and semi-landmarks were positioned in each specimen and relaxed to minimize bending energy [@bookstein_landmark_1997; @bookstein_morphometric_1997]. A complete workflow of landmark and semi-landmark digitalization and relaxation to minimize bending energy was created in Viewbox Version 4.1.0.12 (http://www.dhal.com/viewbox.htm), and the resulting point coordinates were exported into .xlsx files.  

Procrustes superimposition [@kendall_shape_1984; @mitteroecker_advances_2009; @ohiggins_study_2000] was performed using the Morpho v.2.9  package [@schlager_morpho_2017] on RStudio IDE [@rstudio_team_rstudio_2019; @r_core_team_r_2019]. After performing Procrustes superimposition and obtaining a new set of coordinates, principal component analysis (PCA) was performed to reduce the dimensionality of the data [@james_introduction_2013; @pearson_lines_1901]. There are multiple reasons to use dimensionality reduction when dealing with high-dimension data on classification: to avoid having more predictors than observations (p > n), avoid collinearity of predictors, reduce the dimensions of the feature space, and avoid overfitting due to an excessive number of degrees of freedom (simple structure with lower number of variables). Principal component analysis achieves dimensionality reduction by identifying the linear combinations that best represent the predictors on an unsupervised manner. The principal components (PCs) of a PCA aim to capture as high a variance as possible for the complete data [@james_introduction_2013], and PCs that capture the highest variance need not necessarily be the best for classification. For the present work, PCs that represent 95% of variance are selected as predictors for training the machine learning models. The threshold of 95% of variance is arbitrarily selected because it balances retaining most of the dataset variance with a reduced number of variables. The identification of best PCs for classification is performed automatically by the machine learning models using the caret v.6.0.92 package [@kuhn_building_2008].   

![Figure 3. Top: template/atlas for a randomly selected flake with the defined landmarks, curves, and surfaces. Bottom: landmark positioning after sliding to minimize bending energy on a pseudo-Levallois point. Fixed landmarks are indicated in red](Figures/Template and BE.png)

#### 2.2.1 Performance of procrustes, PCA and model training      

The following code sources the [22 Muggle 2D data](Scripts/22 Muggle 3D data.R) script. The [22 Muggle 2D data](Scripts/22 Muggle 3D data.R) loads all *.csv* files containing 3D coordinates, performs procrustes alignment using Morpho [@schlager_morpho_2017], and renames each specimen using the name of the *.csv* file on which they were stored.    

A *nosymproc* [@schlager_morpho_2017] object called **Coord.3D** is created into the [Data](Data) folder. The *nosymproc* contains the orientated coordinates, mean shape and results from PC analysis.      


```{r eval=FALSE}
# Source over 3D data
source("Scripts/22 Muggle 3D data.R")
```


### 2.3	Machine learning and resampling techniques    

Different machine learning models treat the provided data differently. As a result, different models have different strengths and weaknesses. No universal model exists for all problems. Thus, testing several models is an important step in machine learning. It allows to compare the performance of different models, identify the best model for the given task, it provides a general overview of the difficulty or ease of the problem, and it can serve as indication of possible underlying problems with the data (such as overfitting, or unbalanced datasets). Machine learning is a quickly developing field were a high number of models exists. The present work tests ten machine learning models for the classification of flake categories. These models cover some of the most commonly employed algorithms [@jamal_machine_2018] and provide an extensive analysis for the classification of backed flake categories.    

  * **Linear discriminant analysis (LDA):** reduces dimensionality in an attempt to maximize the separation between classes, while decision boundaries divide the predictor range into regions [@fisher_use_1936; @james_introduction_2013].   
  * **K-nearest neighbor (KNN):** classifies cases by assigning the class of similar known cases. The “k” in KNN references the number of cases (neighbors) to consider when assigning a class, and it must be found by testing different values. Given that KNN uses distance metrics to compute nearest neighbors and that each variable is in different scales, it is necessary to scale and center the data prior to fitting the model [@cover_nearest_1967; @lantz_machine_2019].    
  * **Logistic regression:** essentially adapts the multiple linear regression by raising Euler’s constant to its output in the numerator (plus one in the case of the denominator). This results in probability values ranging from 0 to 1which allows obtaining predictions for categorical outcomes [@cramer_early_2004; @walker_estimation_1967].    
  * **Decision tree with C5.0 algorithm:** uses recursive partitioning to divide a dataset into homogeneous groups. The C5.0 algorithm uses entropy (measure of degree of mixture between classes) to determine feature values on which to perform the partitioning. The C5.0 algorithm is an improvement on decision trees for classification [@quinlan_improved_1996; @quinlan_c4_2014].    
  * **Random forest:** uses an ensemble of decision trees. Each tree is grown from a random sample of the variables, allowing for each tree to grow differently and better reflect the complexity of the data and provide additional diversity. Finally, the ensemble of trees casts a vote to generate predictions [@breiman_random_2001].  
  * **•	Gradient Boosting Machine (GBM):** uses a sequential ensemble of decision trees. After training an initial decision tree, GBM trains subsequent trees on a resampled dataset were the weight of observations difficult to classify is increased based in a gradient [@greenwell_package_2019; @ridgeway_generalized_2007] The subsequent trained trees complement decisions and allow for the detection of learning deficiencies and increase model accuracy [@friedman_greedy_2001; @friedman_stochastic_2002].        
  * **Supported vector machines (SVM):** fits hyperplanes into a multidimensional space with the objective of creating homogeneous partitions. The fitting of the hyperplanes is done in order to obtain the maximum margin of separation between classes. The maximum margin of separation is reached by minimizing the cost (value applied for each incorrect classification). SVM’s can use different kernels in order to transform data into linearly separable cases. The kernel selected for the transformations needs to be specified  and plays a key role in the training of a SVM model [@cortes_support-vector_1995; @frey_letter_1991]. The present study tests SVM's with linear, radial, and polynomial kernels. 
  * **Naïve Bayes:** computes class probabilities using Bayes’s rule [@weihs_klar_2005].   

As mentioned above, 66.91% of flakes fall into the definition of core edge flakes with a limited back, resulting in an unbalanced dataset. To counter the unbalanced nature of the experimental dataset, up-sampling was undertaken for the two minority classes, and down-sampling was undertaken for the majority class. Up-sampling categories in a dataset can be considered inappropriate for training machine learning models because it increases the overfit (samples used in the test set to evaluate the model are likely to have already been used in the training set). However, here, the up-sampling of the two minority groups increases the discreteness of these groups but does not affect the potential overlap with the majority class (core edge flakes with limited backs). On the other hand, down-sampling results in missing information because some of the data are removed.    

Random up- and down-sampling is conducted to obtain a balanced dataset and train the models. Because model performance metrics depend on random up- and down-sampling, this process is repeated 30 times, extracting model performance metrics each time and averaging the values. The model with the best performance metrics is then trained again with thirty cycles of up- and down-sampling. The reported variable importance and confusion matrix from which model metric performance are extracted are obtained from these additional cycles of down- and up-sampling.    

3D meshes and data from landmark positioning and Procrustes alignment are already publicly available through the repository of a previous publication using the same experimental collection [@bustos-perez_research_2022; @bustos-perez_combining_2022]. 

#### 2.3.1 Trainign of Machine Learning models       

As mentioned previously, this is a unbalanced data set. Balancing to train the models correctly is done using the `groupdata2` v2.0.2 package using the parameter **"mean"** for size. This means that each group will be up or down sampled to the result of dividing data set size between number of groups. 

  * A `tibble()` called `All_Results` is set to store the results from each model training.  

Each loop works in the following steps:   

  1. The original data set is randomly up and down sampled for each target category.    
  2. Model is trained following the provided hyperparameters and data pre-processing.   
  3. Results from the trained model are extracted and binned to the `All_Results` tibble.       
  4. Steps 1 to 3 are repeated 30 times per model.   

```{r eval=FALSE}
source("Report/Scripts/31 Models on 2D data.R")
source("Report/Scripts/31 Models on 3D data.R")
```

Models trained are respective exported to the respective [2D Results Up and Down sampling](Report/Data/2D Results Up and Down sampling.RData) and [3D Results Up and Down sampling](Report/Data/3D Results Up and Down sampling.RData) files.   

```{r include=FALSE, eval=FALSE}
load("Data/Results Up and Down sampling.RData")
load("Data/SVM Poly Results.RData")
```

Once the bets model is determined, the loop is repeated in order to extract variable importance and predictions in order to construct the confusion matrix. 


## 3. Results    

### 3.1 PCA and machine learning models   

```{r, eval=FALSE}
# Store variance and cumulative variance as df
PC.Plot <- summary(pca)$importance[2:3, 1:25] %>% 
  as.data.frame() %>% t() %>% 
  as.data.frame() 

# make the two plots
ggpubr::ggarrange(
  
  (PC.Plot %>% 
     mutate(PC = rownames(PC.Plot),
            `Proportion of Variance` = `Proportion of Variance`*100) %>% 
     
     ggplot(aes(`Proportion of Variance`, reorder(PC, `Proportion of Variance`))) +
     geom_col(fill = "blue", alpha = 0.65) +
     geom_text(aes(label = round(`Proportion of Variance`, 2)), hjust = "bottom",  size = 2.25) +
     theme_bw() +
     scale_x_continuous(breaks = seq(0, 25, 5), lim = c(0, 25)) +
     ylab(NULL) +
     theme(
       axis.title = element_text(size = 7, color = "black", face = "bold"),
       axis.text = element_text(size = 7, color = "black"))
  ),
  
  (PC.Plot %>% 
     mutate(PC = rownames(PC.Plot),
            `Cumulative Proportion` = `Cumulative Proportion`*100) %>% 
     
     ggplot(aes(`Cumulative Proportion`, reorder(PC, -`Cumulative Proportion`))) +
     geom_col(fill = "blue", alpha = 0.65) +
     geom_text(aes(label = round(`Cumulative Proportion`, 2)), hjust = "top",  size = 2.25) +
     theme_bw() +
     scale_x_continuous(breaks = seq(0, 100, 10), lim = c(0, 100)) +
     ylab(NULL) +
     theme(
       axis.title = element_text(size = 7, color = "black", face = "bold"),
       axis.text.x = element_text(size = 7, color = "black"),
       axis.text.y = element_blank())
  ),
  ncol = 2)
```


The PCA results show that the 25 first principal components account for 95% of the variance in the dataset, with PC1 accounting for 21.39% of variance and PC25 accounting for 0.36% of variance. This represents a substantial reduction in dimensionality from the original number of variables (1,524) and is lower than the sample size (139).  
The following presents the accuracy values for each model after their respective 30 cycles of random up- and down-sampling. Supported vector machines with a polynomial kernel had the highest average value for general accuracy (0.837), closely followed by the random forest model (0.829). The K-nearest neighbor model had the lowest average value for accuracy (0.681), followed by LDA model (0.690). Supported vector machines with a polynomial kernel had the lowest standard deviation in accuracy values (0.018). This indicates that, in addition to being the most precise model on average, SVM with a polynomial kernel is also the most consistent model, being less affected by random up- and down-sampling. The minimum accuracy value of SVM with a polynomial kernel is 0.801, indicating a high accuracy, even when up- and down-sampling result in similar objects.


```{r Results from up and down sampling, fig.width=10, fig.height=5.5, eval=FALSE}
# Set the models factors
All_Results$Model <- factor(All_Results$Model,
                                levels = c(
                                  "LDA", "KNN", "Log. Reg.",
                                  "C5.0 Tree", "Random Forest", "Boosted Tree",
                                  "SVM Linear", "SVM Radial",
                                  "SVM Poly",
                                  "Naïve Bayes"))

# 
All_Results %>% 
  ggplot(aes(Model, Accuracy, fill = Model)) +
  geom_violin(position = position_dodge(1), width = 0.4, alpha = 0.5) +
  geom_boxplot(width = 0.4,
               outlier.shape = NA, alpha = 0.5) +
  geom_jitter(width = 0.15, alpha = 0.9, size = 0.9, shape = 23, aes(fill = Model)) +
  theme_light() +
  ylab("Accuracy after each cycle of up and down sampling") +
  ggsci::scale_fill_aaas() +
  scale_x_discrete(labels = c(
    "LDA", "KNN", "Log. Reg.",
    "C5.0\nTree", "Random\nForest", "Boosted\nTree",
    "SVM\nLinear", "SVM\nRadial",
    "SVM\nPoly",
    "Naïve\nBayes")) +
  xlab(NULL) +
  theme(
    legend.position = "none",
    axis.text = element_text(color = "black", size = 8),
    axis.title = element_text(color = "black", size = 8.5)
    )
```

The following table presents performance metrics of the SVM with a polynomial kernel for the classification of the three products. The prevalence/no information ratio was kept constant at 0.33 for all three categories as a result of random up- and down-sampling to obtain balanced datasets. In general, the three products had high values for performance metrics, with Pseudo-Levallois points standing out in this regard. Following pseudo-Levallois points, core edge flakes had the second-best general values, with a sensitivity close to 0.8. Core edge flakes with a limited back had the lowest values for performance metrics.   

```{r, eval=FALSE}
# Performance metrics of SVM with polynomial kernel
confusionMatrix(Conf_SVM_Poly$pred, Conf_SVM_Poly$obs)
```

### 3.2 Variable importance    

The following figure presents variable importance after 30 cycles of up- and down-sampling and k-fold cross-validation for the SVM with polynomial kernel models. Core edge flakes and pseudo-Levallois points share variable importance in terms of their identification, while core edge flakes with a limited back have their own variable importance. However, in both cases, there is agreement regarding which four PC are important for the classification of backed artefacts. In both cases, PC7 is considered the most important, followed by PC4 and PC3. PC1 is considered the second most important PC for the identification of core edge flakes and pseudo-Levallois points (81.08), but its importance is diminished dramatically in the case of core edge flakes with a limited back (56.32).    

```{r, eval=FALSE}
# Variable importance 
ED_VarImp$Importance <- rowMeans(ED_VarImp[,2:31])
ED_VarImp$PC <- colnames(PCA_Coord)[1:25]

EDlb_VarImp$Importance <- rowMeans(EDlb_VarImp[,2:31])
EDlb_VarImp$PC <- colnames(PCA_Coord)[1:25]

ggpubr::ggarrange(
(ED_VarImp %>% select(Importance, PC) %>% 
  top_n(15, Importance) %>% 
  ggplot(aes(Importance, reorder(PC, Importance), fill = Importance)) +
  geom_bar(stat= "identity", position = "dodge") +
  geom_text(aes(label = round(Importance, 2)), 
            position = position_stack(vjust = 0.5), size = 2) +
  scale_fill_gradient(low = "red", high = "blue") +
  guides(fill = "none") +
  ylab(NULL) +
  theme_light() +
  labs(title = "PC importance for Core Edge Flakes and pseudo-Levallois\npoints") +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 7),
    plot.title = element_text(color = "black", size = 7))
),

(EDlb_VarImp %>% select(Importance, PC) %>% 
  top_n(15, Importance) %>% 
  ggplot(aes(Importance, reorder(PC, Importance), fill = Importance)) +
  geom_bar(stat= "identity", position = "dodge") +
  geom_text(aes(label = round(Importance, 2)), 
            position = position_stack(vjust = 0.5), size = 2) +
  scale_fill_gradient(low = "red", high = "blue") +
  guides(fill = "none") +
  ylab(NULL) +
  theme_light() +
  labs(title = "PC importance for Core Edge Flakes With a Limited\nBack") +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 7),
    plot.title = element_text(color = "black", size = 7))
),
ncol = 2
)
```

None of the manually recorded metrics provided significant correlation with PC7 and PC4 scores. Visual evaluation indicates that PC7 is capturing flake morphology in plain view. Flakes with a triangular morphology have negative values, while more rectangular flakes tend to have 0 values. Flakes presenting shapes wider than they are long tend to have positive values. Although it is important to consider that the high variability in flake shape morphology is introducing underlying factors that affect PC7 scores.   

![Flake shape variation according to PC7 values. Figures represent mean shape morphology after Procrustes alignment (scale independent)](Figures/PC7.png)

![Flake shape variation according to PC4 values. Figures represent mean shape morphology after Procrustes alignment (scale independent)](Figures/PC4.png)    

A visual evaluation of PC4 indicates that the values are likely the result of an interaction between the ratio of flake surface/volume to platform size and the angle between the backed edge and the platform. Flakes with high ratios of surface/volume to platform surface and open angles between the platform and backed edge tend to have negative values. On the other hand, flakes with large platforms (and therefore lower flake surface/volume ratios) and straight angles between the platform and backed edge have positive values.    

![Flake shape variation according to PC3 values. Figures represent mean shape morphology after Procrustes alignment (scale independent)](Figures/PC3.png)   

![Flake shape variation according to PC1 values. Figures represent mean shape morphology after Procrustes alignment (scale independent)](Figures/PC1.png)   

PC3 offers a much clearer interpretation. A visual evaluation of PC3 values according to flake shape indicates that PC3 captures transversal flake morphology and the relationship between thickness and width. A multiple linear regression using the interaction between ratio of flake width to thickness and IPA as predictors shows a moderate correlation with PC3 values (p < 0.001, adjusted $r^2$ = 0.65). The coefficient of interaction between the ratio of width to thickness and IPA is 0.17, while the coefficient of IPA is -0.77. A counterintuitive coefficient of -12.79 for the ratio of flake width to thickness is obtained in the interaction model. An individual regression of PC3 values predicted from the ratio of flake width to thickness provides a moderate correlation (p < 0.001; $r^2$ = 0.6), with a positive coefficient of 6.46. This indicates that the counterintuitive coefficient of -12.79 obtained for the width to thickness ratio in the interaction model is a result of a Simpson’s Paradox [@simpson_interpretation_1951], in which the signal is reversed. It is also important to note the strong correlation between the carenated index and the ratio of flake width to thickness (p < 0.001; $r^2$ = 0.9). Thus, although PC3 regresses better with the ratio of width to thickness than with the carenated index, it can be considered that it is capturing flake thinness relative to thickness.    



A multiple linear regression for the prediction of PC1 values shows a moderate correlation when the elongation index and carenated index are employed as predictors (p < 0.001; adjusted $r^2$ = 0.63). The elongation index has the highest significance and the highest estimated value (-39.27), while the carenated index has an estimated value of -4.26. The negative and high value of the estimate for the elongation index indicates that, as the tendency of a product to be elongated increases (becoming longer relative to its width), the values of PC1 will decrease, while all other variables will remain constant. The negative estimate of the carenated index also indicates that, as a product becomes thinner, the values of PC1 will decrease. Thus, the positive values of PC1 are representing thick products with a low elongation.



### 3.3 Group discreteness through confusion matrix and PCA biplots   

The confusion matrix of SVM with a polynomial kernel illustrates the directionality of confusion between the predicted and true values of classified technological products. Pseudo-Levallois points have the best identification, in accordance with the reported sensitivity and specificity. In general, it is very difficult to mistake pseudo-Levallois points for any of the two considered technological products. Wrongly considering a pseudo-Levallois point a core edge flake is residual for the model (0.07). Although mistaking a pseudo-Levallois point for a core edge flake with a limited back is slightly more common (1.98), there is still a very low confusion value.     

```{r Confusion matrix of SVMP, eval=FALSE}
# Extract confusion matrix
CFM <- confusionMatrix(Conf_SVM_Poly$pred, Conf_SVM_Poly$obs)$table
CFM <- reshape2::melt(CFM)

# Normalize the confusion matrix
CFM <- CFM %>% mutate(
  Value = case_when(
    Reference == "ED" ~ (value/sum(confusionMatrix(Conf_SVM_Poly$pred, Conf_SVM_Poly$obs)$table[1:3]))*100,
    Reference == "EDlb" ~ (value/sum(confusionMatrix(Conf_SVM_Poly$pred, Conf_SVM_Poly$obs)$table[4:6]))*100,
    Reference == "p_Lp" ~ (value/sum(confusionMatrix(Conf_SVM_Poly$pred, Conf_SVM_Poly$obs)$table[7:9]))*100)
)

# and plot
CFM %>% 
  ggplot(aes(Reference, Prediction, fill = Value)) + 
  geom_tile(alpha = 0.75) +
  geom_text(aes(label = round(Value, 2)), size = 3) +
  scale_fill_gradient(low = "white", high = "blue")  +
  scale_x_discrete(position = "top") +
  scale_y_discrete(limits=rev) +
  theme_bw() +
  coord_fixed() +
  theme(legend.position = "none",
        axis.title = element_text(size = 8, color = "black", face = "bold"),
        axis.text = element_text(size = 7.5, color = "black"),
        title = element_text(size = 8, color = "black", face = "bold"))
```

Core edge flakes and core edge flakes with a limited back offer slightly higher frequencies of misidentifications, although they maintain high values for sensitivity and specificity. For the SVM with a polynomial kernel, it is more common to mislabel core edge flakes as core edge flakes with a limited back (21.56) than the reverse (20.2). For both technological groups of flakes, their incorrect identification as pseudo-Levallois flakes is minimal, although this incorrect identification has a higher frequency in core edge flakes with a limited back (4.52) than in core edge flakes (0.63).   

The above interpretation of the PCs, biplot visualization, and descriptive statistics of PC values allow us to evaluate the morphological features captured by the geometric morphometrics and the characterization of each type of technological backed flake. Pseudo-Levallois points are characterized by having negative values for PC7 (mean = -6.33; SD = 6.00), indicative of the importance of the triangular morphology in their identification. This is particularly observable on the biplots in which the clustering of pseudo-Levallois points on negative values results in a limited overlap with the remainder of the backed flake types.   

```{r Biplots, fig.width=10, eval=FALSE}
ggpubr::ggarrange(
(PCA_Coord %>% ggplot(aes(PC7, PC4, fill = New_Art.Type)) +
  geom_vline(xintercept = 0, alpha = 0.7, linetype = "dashed") +
  geom_hline(yintercept = 0, alpha = 0.7, linetype = "dashed") +
  stat_ellipse(geom = "polygon", alpha = 0.2, aes(fill = New_Art.Type),
               level = 0.8) +
  geom_point(aes(color = New_Art.Type), size = 1) +
  xlab(paste0("PC7 (", round((summary(pca)$importance[2,7])*100, 2), "%)")) +
  ylab(paste0("PC4 (", round((summary(pca)$importance[2,4])*100, 2), "%)")) +
  ggsci::scale_fill_lancet(name = "Backed flake type",
                         labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  ggsci::scale_color_lancet(name = "Backed flake type",
                          labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  theme_light() +
  guides(color = guide_legend(nrow = 1, title.position = "top"),
         fill = guide_legend(nrow = 1, title.position = "top")) +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 9),
    axis.title.y = element_text(color = "black", size = 9),
    legend.title = element_text(color = "black", size = 9),
    legend.text = element_text(color = "black", size = 9),
    legend.position = "bottom")),

(PCA_Coord %>% ggplot(aes(PC7, PC3, fill = New_Art.Type)) +
  geom_vline(xintercept = 0, alpha = 0.7, linetype = "dashed") +
  geom_hline(yintercept = 0, alpha = 0.7, linetype = "dashed") +
  stat_ellipse(geom = "polygon", alpha = 0.2, aes(fill = New_Art.Type),
               level = 0.8) +
  geom_point(aes(color = New_Art.Type), size = 1) +
  xlab(paste0("PC7 (", round((summary(pca)$importance[2,7])*100, 2), "%)")) +
  ylab(paste0("PC3 (", round((summary(pca)$importance[2,3])*100, 2), "%)")) +
  ggsci::scale_fill_lancet(name = "Backed flake type",
                           labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  ggsci::scale_color_lancet(name = "Backed flake type",
                            labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  theme_light() +
  guides(color = guide_legend(nrow = 1, title.position = "top"),
         fill = guide_legend(nrow = 1, title.position = "top")) +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 9),
    axis.title.y = element_text(color = "black", size = 9),
    legend.title = element_text(color = "black", size = 9),
    legend.text = element_text(color = "black", size = 9),
    legend.position = "bottom")),
nrow = 1,
ncol = 2,
common.legend = TRUE,
legend = "bottom"
)

ggpubr::ggarrange(
(PCA_Coord %>% ggplot(aes(PC4, PC3, fill = New_Art.Type)) +
  geom_vline(xintercept = 0, alpha = 0.7, linetype = "dashed") +
  geom_hline(yintercept = 0, alpha = 0.7, linetype = "dashed") +
  stat_ellipse(geom = "polygon", alpha = 0.2, aes(fill = New_Art.Type),
               level = 0.8) +
  geom_point(aes(color = New_Art.Type), size = 1) +
  xlab(paste0("PC4 (", round((summary(pca)$importance[2,4])*100, 2), "%)")) +
  ylab(paste0("PC3 (", round((summary(pca)$importance[2,3])*100, 2), "%)")) +
  ggsci::scale_fill_lancet(name = "Backed flake type",
                           labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  ggsci::scale_color_lancet(name = "Backed flake type",
                            labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  theme_light() +
  guides(color = guide_legend(nrow = 1, title.position = "top"),
         fill = guide_legend(nrow = 1, title.position = "top")) +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 9),
    axis.title.y = element_text(color = "black", size = 9),
    legend.title = element_text(color = "black", size = 9),
    legend.text = element_text(color = "black", size = 9),
    legend.position = "bottom")),

(PCA_Coord %>% ggplot(aes(PC7, PC1, fill = New_Art.Type)) +
  geom_vline(xintercept = 0, alpha = 0.7, linetype = "dashed") +
  geom_hline(yintercept = 0, alpha = 0.7, linetype = "dashed") +
  stat_ellipse(geom = "polygon", alpha = 0.2, aes(fill = New_Art.Type),
               level = 0.8) +
  geom_point(aes(color = New_Art.Type), size = 1) +
  xlab(paste0("PC7 (", round((summary(pca)$importance[2,7])*100, 2), "%)")) +
  ylab(paste0("PC1 (", round((summary(pca)$importance[2,1])*100, 2), "%)")) +
  ggsci::scale_fill_lancet(name = "Backed flake type",
                           labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  ggsci::scale_color_lancet(name = "Backed flake type",
                            labels = c("Core edge flake", "Core edge flake with limited back", "pseudo-Levallois Point")) +
  theme_light() +
  guides(color = guide_legend(nrow = 1, title.position = "top"),
         fill = guide_legend(nrow = 1, title.position = "top")) +
  theme(
    axis.text.y = element_text(color = "black", size = 7),
    axis.text.x = element_text(color = "black", size = 7),
    axis.title.x = element_text(color = "black", size = 9),
    axis.title.y = element_text(color = "black", size = 9),
    legend.title = element_text(color = "black", size = 9),
    legend.text = element_text(color = "black", size = 9),
    legend.position = "bottom")),
nrow = 1,
ncol = 2,
common.legend = TRUE,
legend = "bottom"
)
```

As mentioned above, PC4 is interpreted as capturing the relationships between platform size, flake volume, and the angle between the backed lateral edge and the platform. The three defined technological products show differences regarding this component. Core edge flakes generally have positive values (mean = 6.14, SD = 9.32). These generally positive values are indicative of large platforms, while the platform and the backed edge form an angle close to 90º. Biplot visualization is especially informative in this respect, because it results in core edge flakes being clustered in positive values. Core edge flakes with a limited back and pseudo-Levallois points have similar negative values for PC4, with a high degree of overlap (respective means of -1.29 and -4.01 and SDs of 10.1 and 13.7). These negative values indicate the importance of small platforms relative to the volume of the product and the open angle between the platform and the backed lateral of the flake. This open angle can be associated with the deviation between the morphological and percussion axes.   
Although PC3 and PC1 are considered the third and fourth most important variables for discriminating between the defined technological products, the distribution of the main values shows some tendencies of interest. PC3 is capturing the interaction between IPA and the ratio of flake width to thickness. The mean value for core edge flakes (-6.41) indicates that they tend to be less wide with respect to their thickness, while the slightly positive mean values of core edge flakes with a limited back (1.59) and pseudo-Levallois points (2.78) indicate a general tendency to be wider with respect to their thickness.    

PC1 mostly captures the relationships of elongation and thickness, where elongated, thin products are characterized by negative values. Core edge flakes have a tendency toward negative values (mean = -8.26; SD = 16.3), indicating that they are generally elongated products. This relatively longer elongation can be associated with core edge flakes sharing the morphological and percussion axes. Pseudo-Levallois points share the opposite tendency, having generally positive values (mean = 8.14; SD = 19.9), which are indicative of their being short non-elongated products. Core edge flakes with a limited back have a slightly positive tendency (mean = 1.26; SD = 17.5), which is indicative of their not usually being elongated products.   

```{r Violin and box plots, fig.width=9, fig.height=4, eval=FALSE}
# Get variables of interest
PCA_Coord %>% 
  select(PC1, PC3, PC4, PC7, ARTIFACTTYPE) %>% 
  pivot_longer(
    cols = c(PC1, PC3, PC4, PC7),
    names_to = "PC",
    values_to = "Value") %>% 
  
# Plot
  ggplot(aes(ARTIFACTTYPE, Value, fill = ARTIFACTTYPE)) +
  geom_violin(alpha = 0.4, width = 0.75) +
  geom_boxplot(alpha = 0.75,  width = 0.25, outlier.size = 0) +
  facet_grid(~ PC, scales = "free") +
  geom_jitter(width = 0.15, alpha = 1, size = 0.9, shape = 23, aes(fill = ARTIFACTTYPE)) +
  coord_flip() +
  theme_light() +
  scale_x_discrete(labels = c("Core Edge\nFlake",
                              "Core edge with\nlimited back",
                              "pseudo-Levallois\nPoint")) +
  xlab(NULL) +
  ylab("PC value") +
  ggsci::scale_fill_lancet() +
  theme(strip.text = element_text(color = "black", face = "bold", size = 8),
        strip.background = element_rect(fill = "white", colour = "black", size = 1),
        legend.position = "none",
        axis.text = element_text(color = "black", size = 7),
        axis.title = element_text(color = "black", size = 7))
```


## 4. Discussion   

Our results show that geometric morphometrics, along with machine learning models, can easily differentiate between core edge flakes, core edge flakes with a limited back, and pseudo-Levallois points from discoidal and recurrent centripetal Levallois reduction sequences. The best model (SVM with a polynomial kernel) obtained high general average precision values (0.837).Previous research has outlined the advantages of SVM’s when dealing with the classification of lithic products [@bustos-perez_combining_2022]. Because of their features (hyperplane fitting, use of margins to find best separation, and use of a cost value for each misclassification), SVM’s seem to be well suited to deal with the classification of lithic categories and in the present study they outperformed other machine learning models. When considering each technological product individually, pseudo-Levallois points stood out as the most clearly differentiable of the three categories considered, with performance metrics above 0.9. Following pseudo-Levallois points, core edge flakes were the most clearly identifiable technological products, with a notable sensitivity value (0.778). Although core edge flakes with a limited back are the technological product with the lowest sensitivity (0.753), this is not a low value or substantially different from core edge flakes’ sensitivity. This indicates that geometric morphometrics are capturing the technological features defining each category and that they are discrete categories with little overlap. Thus, their use (and, more specifically, the use of the core edge flakes with a limited back as a category) for analysis in lists of technological products is justifiable.  

@sullivan_debitage_1985 previously called attention to the use of technological categories of flakes. Their critique focuses on the lack of consistency in defining and using technological categories of flakes, along with a lack of consistency regarding the attributes employed to define them. Although their critique concerns flakes from bifacial retouch, it represents an important word of caution. The present study has shown that the three categories are well defined in terms of morphological and technological features [see also @faivre_late_2017]. These morphological and technological features can be captured by geometric morphometrics and employed for accurate classifications. Thus, little ambiguity exists in the categories employed to classify backed flakes, which are connected to two of the main Middle Paleolithic flaking strategies (discoidal and recurrent centripetal Levallois). These morphological and technological features can be captured by geometric morphometrics and employed for accurate classifications. Thus, little ambiguity exists in the categories employed to classify backed flakes, which are connected to two of the main Middle Paleolithic flaking strategies (discoidal and recurrent centripetal Levallois).   

Meignen [-@meignen_les_1993; -@meignen_persistance_1996] first proposed the category “core edge flake with a limited back” because better individualized and characterized the predominant centripetal debitage present at the site of Les Canalettes (Aveyron, France). The term has, however, seen limited use since, mainly employed when characterizing lithic assemblages produced via recurrent centripetal methods [@bernard-guelle_site_2004; @bourguignon_ioton_2010; @duran_lindustrie_2005; @duran_mousterien_2004; @duran_variabilite_2006]. The use of the “core edge flake with a limited back” category is usually overlooked (or merged into the core edge flake category) when lists of technological products are employed for the analysis of Middle Paleolithic lithic assemblages [@debenath_handbook_1994; @rigaud_les_1988; @shea_middle_2013]. Although their merger into the core edge flake category is perfectly valid for analyzing lithic assemblages, differentiating between classic core edge flakes and core edge flakes with a limited back in lists of technological products can increase the resolution of and enrich the analysis of lithic assemblages. This, of course, results in a better understanding of the technical choices and constraints faced by past groups and may allow for better understanding of the relationships between technology and raw material, as well as volumetric core management, and could contribute to improving comparisons between assemblages so as to avoid simple and overly generic technological definitions and to avoid merging what are clearly different reduction concepts. Such generic definitions are often used to discuss human behaviors and cultural traditions and even human migrations [@blinkhorn_directional_2021], but they remain difficult to interpret [@romagnoli_neanderthal_2022]. They do not always reflect the diversity and specificity of the technological choices and constraints past human groups faced. A more in-depth analysis of variability in the techno-morphological characteristics of stone artifacts, in association with other approaches, such as refitting and taphonomic analysis, could also allow archaeologists to better understand the processes of assemblage formation.   

Previous researchers have pointed out the morphological and technological differences between classic core edge flakes and core edge flakes with a limited back. @beyries_etude_1983 originally defined classic core edge flakes as having very similar morphological and percussion axes. Meignen [-@meignen_les_1993; -@meignen_persistance_1996] used the “core edge flake with a limited back” category to classify core edge flakes in which the morphological and percussion axes were not aligned. Additionally, most of the examples presented [@meignen_persistance_1996] had the flake back offset from the percussion axis. @peresani_les_2003 also points out that, as a morphological feature, the flake back of core edge flakes with a limited back will be offset in regards the axis of percussion. These features of alignment between the flake back and percussion axis are captured by PC4, with pseudo-Levallois and core edge flakes with a limited back having similar negative values, indicative of an offset backed edge.    

@peresani_les_2003 also indicates that classic core edge flakes will be elongated as a result of percussion running parallel to the core edge. Following @peresani_les_2003, core edge flakes with a limited back will have length/width ratios close to 1 as a result of percussion encountering ridges perpendicular to its direction. Although PC1 is the fourth most important variable for discrimination between backed products in the present study, it is clearly capturing the feature of elongation for the differentiation of classic core edge flakes. Classical core edge flakes have, on average, negative PC1 values, which are indicative of elongation. On the other hand, core edge flakes with a limited back and pseudo-Levallois points are characterized by, on average, positive PC1 values, which are indicative of their having similar values for width and length or even being wider than they are long.     

The directionality of the confusion matrixes shows that the main drawback reduced the identification of core edge flakes is their identification as core edge flakes with a limited back. Two underlying causes of confusion between core edge flakes and core edge flakes with a limited back can be considered: first, an increased deviation between the technological and morphological axes and, second, an increased angle between the platform and backed edge, which results in changing the morphological axis. These two factors of confusion can occur at the same time or individually, blurring the division between products in cases of similarity. This overlap is inherent in the morphological variability and defining features of both technological products. However, despite these overlapping features, a high degree of separation between both products is achieved by the machine learning model.   

The present study included all backed flakes from a series of experimental recurrent centripetal cores. As a result, backed artifacts that fall within the definition of “core edge flakes with a limited back” were the overwhelming majority (n = 93, 66.91%). Consequently, it was necessary to use up- and down-sampling techniques to obtain balanced datasets [@ganganwar_overview_2012; @kumar_classification_2012]. The most up-sampled product (pseudo-Levallois) is also the one with the highest values for identification metrics, probably as a result of overfitting (the model is classifying repeated samples from the training set). Given the strict definition adopted to classify a backed artifact as either a core edge flake or a pseudo-Levallois point, their morphological variability is limited, and the likelihood of their overlapping is small. This is logical given their definitions and can be observed in the biplots of most important PCs for thee classification of backed products. In the four biplots, there is little overlapping of confidence ellipses of core edge flakes and pseudo-Levallois flakes. Moreover, the confidence ellipsis of core edge flakes with a limited back does seem to be intermediate between those of other two categories. Thus, although up-sampling imposes some limitations, it does not seem to affect the overall results regarding backed flake classification.    

Core edge flakes with a limited back were not up-sampled, thus avoiding the risk of overfitting their classification (having an observation on the training set repeated in the test set). The results show a very limited misidentification of core edge flakes as pseudo-Levallois points and their moderate confusion with core edge flakes. This indicates that core edge flakes with a limited back are being correctly identified despite the probable overfitting in the identification of core edge flakes and pseudo-Levallois points.   

Ambiguity and overlap between some technological categories of flakes are common. Combining quantitative methods and techniques has showed to be a useful approach to distinguish between backed products extracted during Discoid and recurrent centripetal Levallois knapping strategies. The present research shows that geometric morphometrics along with machine learning models is an effective way also to test for the discreteness of categories, the possible directionality of confusions between categories and to quantify the features which best characterize and define each category.    

## 5. Conclusions   

The present work was aimed to evaluate whether “core edge flakes with a limited back” are a discrete category that can be separated from classical core edge flakes and pseudo-Levallois points. These products are defined by a series of morphological and technological features (overall shape morphology, morphological symmetry, axis of percussion, and position and angle of the backed edge). These features and their variability can be quantitatively captured by geometric morphometrics and employed in machine learning models to test for the discreteness of the categories. The results indicate that, while some overlap exists between classical core edge flakes and core edge flakes with a limited back (pseudo-Levallois points are clearly differentiated), in general, they are easily distinguishable. Additionally, geometric morphometrics and machine learning also succeed in capturing the PC directly associated with morphological and technological features employed to define each technological category. Core edge flakes with a limited back are therefore clearly distinguishable from classic core edge flakes and that geometric morphometrics can be employed to test for the validity of defined technological categories, the directionality of confusions, and the features characterizing these categories.    

## 6. Acknowledgments   

This research has been supported by the project SI1/PJI/2019-00488 funded by Comunidad Autónoma de Madrid and Universidad Autónoma de Madrid.   


## 7. References  

</div>   